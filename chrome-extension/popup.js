document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector('input[value="hiragana"]'),t=document.querySelector('input[value="katakana"]'),n=document.getElementById("fontSize"),c=document.getElementById("fontSizeVal"),o=document.getElementById("englishMode"),s=document.getElementById("sitePreference"),a=document.getElementById("currentSite"),d=document.getElementById("settingsBtn"),r=document.getElementById("applyBtn");let i="";chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(e[0]){const t=new URL(e[0].url);i=t.hostname,a.textContent=`Current site: ${i}`,u()}}),chrome.storage.sync.get(["mode","fontSize","englishMode"],s=>{"katakana"===s.mode?t.checked=!0:e.checked=!0,s.fontSize&&(n.value=s.fontSize,c.textContent=s.fontSize+"%"),s.englishMode&&(o.checked=!0)});const u=()=>{chrome.storage.sync.get(["sitePreferences"],e=>{const t=(e.sitePreferences||{})[i]||"default";s.value=t})};n.addEventListener("input",()=>{c.textContent=n.value+"%"}),s.addEventListener("change",()=>{chrome.storage.sync.get(["sitePreferences"],e=>{const t=e.sitePreferences||{};"default"===s.value?delete t[i]:t[i]=s.value,chrome.storage.sync.set({sitePreferences:t})})}),d.addEventListener("click",()=>{chrome.tabs.create({url:"settings.html"})}),r.addEventListener("click",()=>{const e={mode:document.querySelector('input[name="mode"]:checked').value,fontSize:n.value,displayMode:"always",englishMode:o.checked};chrome.storage.sync.set(e,()=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{t[0]&&chrome.tabs.sendMessage(t[0].id,{action:"updateFurigana",settings:e})})})})});